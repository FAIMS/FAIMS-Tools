#!/usr/bin/env bsh

String funName() {
  namespace = this.callstack.get(1);
  return namespace.getInvocationLine() + ": " + namespace.getInvocationText();
}

String getStdout(Object runnable) {
  // Create a stream to hold the output
  ByteArrayOutputStream baos = new ByteArrayOutputStream();
  PrintStream ps = new PrintStream(baos);
  // IMPORTANT: Save the old System.out!
  PrintStream old = System.out;
  // Tell Java to use your special stream
  System.setOut(ps);
  // Print some output: goes to your special stream
  runnable.run();
  // Put things back
  System.out.flush();
  System.setOut(old);
  // Show what happened
  return baos.toString();
}

void stdout(String s) {
  // Alternative to `print` which allows stdout to be grabbed using `getStdout`
  System.out.println(s);
}

sourceRelative("mock.bsh");
sourceRelative("../module/ui_logic.bsh");
print("");
try {
  sourceRelative("tests.bsh");
  print("=== ALL TESTS PASSED ===");
} catch (FileNotFoundException e) {
  print(
      "=== NO TESTS IMPLEMENTED. TESTS SHOULD BE PLACED IN " +
      "`tests/tests.bsh`. ==="
  );
} catch (Exception e) {
  print(e);
  print("=== ONE OR MORE TESTS FAILED ===");
}
